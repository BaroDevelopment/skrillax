<?xml version="1.0" encoding="UTF-8" ?>
<packets module="world">
    <struct name="Position">
        <attribute name="region" type="u16" />
        <attribute name="pos_x" type="f32" />
        <attribute name="pos_y" type="f32" />
        <attribute name="pos_z" type="f32" />
        <attribute name="heading" type="u16" />
    </struct>

    <enum name="PvpCape" type="u8">
        <variation name="None" value="0" />
        <variation name="Red" value="1" />
        <variation name="Gray" value="2" />
        <variation name="Blue" value="3" />
        <variation name="White" value="4" />
        <variation name="Yellow" value="5" />
    </enum>

    <enum name="AliveState" type="u8">
        <variation name="Spawning" value="0" />
        <variation name="Alive" value="1" />
        <variation name="Dead" value="2" />
    </enum>

    <enum name="JobType" type="u8">
        <variation name="None" value="0" />
        <variation name="Trader" value="1" />
        <variation name="Thief" value="2" />
        <variation name="Hunter" value="3" />
    </enum>

    <enum name="PlayerKillState" type="u8">
        <variation name="None" value="0xFF" />
        <variation name="Purple" value="1" />
        <variation name="Red" value="2" />
    </enum>

    <enum name="ActiveScroll" type="u8">
        <variation name="None" value="0" />
        <variation name="ReturnScroll" value="1" />
        <variation name="JobScroll" value="2" />
    </enum>

    <enum name="InventoryItemContentData">
        <variation name="Equipment">
            <attribute name="plus_level" type="u8" />
            <attribute name="variance" type="u64" />
            <attribute name="durability" type="u32" />
            <attribute name="magic" type="Vec" inner="InventoryItemMagicData" list-type="length" />
            <attribute name="bindings_1" type="InventoryItemBindingData" />
            <attribute name="bindings_2" type="InventoryItemBindingData" />
            <attribute name="bindings_3" type="InventoryItemBindingData" />
            <attribute name="bindings_4" type="InventoryItemBindingData" />
        </variation>
        <variation name="Expendable">
            <attribute name="stack_size" type="u8" />
        </variation>
    </enum>

    <enum name="InteractOptions" type="u8">
        <variation name="None" value="0" />
        <variation name="Talk" value="2">
            <attribute name="options" type="Vec" inner="u8" list-type="length" />
        </variation>
    </enum>

    <enum name="BodyState" type="u8">
        <variation name="None" value="0" />
        <variation name="Berserk" value="1" />
        <variation name="Untouchable" value="2" />
        <variation name="GM_Invincible" value="3" />
        <variation name="GM_Invisible" value="4" />
        <variation name="Berserk2" value="5" />
        <variation name="Stealth" value="6" />
        <variation name="Invisible" value="7" />
    </enum>

    <enum name="GroupSpawnType" type="u8">
        <variation name="Spawn" value="1" />
        <variation name="Despawn" value="2" />
    </enum>

    <enum name="EntityRarity" type="u8">
        <variation name="Normal" value="0" />
        <variation name="Champion" value="1" />
        <variation name="Unique" value="3" />
        <variation name="Giant" value="4" />
        <variation name="Titan" value="5" />
        <variation name="Elite" value="6" />
        <variation name="Elite_String" value="7" />
        <variation name="Unique2" value="8" />
        <variation name="NormalParty" value="16" />
        <variation name="ChampionParty" value="17" />
        <variation name="UniqueParty" value="19" />
        <variation name="GiantParty" value="20" />
        <variation name="TitanParty" value="21" />
        <variation name="EliteParty" value="22" />
        <variation name="Unique2Party" value="24" />
    </enum>

    <enum name="GroupSpawnDataContent">
        <variation name="Despawn">
            <attribute name="id" type="u32" />
        </variation>
        <variation name="Spawn">
            <attribute name="object_id" type="u32" />
            <attribute name="data" type="EntityTypeSpawnData" />
        </variation>
    </enum>

    <enum name="EntityTypeSpawnData">
        <variation name="Item">

        </variation>
        <variation name="Gold">
            <attribute name="amount" type="u32" />
            <attribute name="unique_id" type="u32" />
            <attribute name="position" type="Position" />
            <attribute name="owner" type="Option" inner="u32" />
            <attribute name="rarity" type="u8" />
        </variation>
        <variation name="Character">
            <attribute name="scale" type="u8" />
            <attribute name="berserk_level" type="u8" />
            <attribute name="pvp_cape" type="PvpCape" />
            <attribute name="beginner" type="bool" />
            <attribute name="title" type="u8" />
            <attribute name="equipment" type="Vec" inner="u32" list-type="length" /><!-- TODO, should have another u8 for upgrade level -->
            <attribute name="avatar_items" type="Vec" inner="u32" list-type="length" /><!-- TODO, should have another u8 for upgrade level -->
            <attribute name="mask" type="Option" inner="u32" /><!-- TODO, has more data -->
            <attribute name="movement" type="EntityMovementState" />
            <attribute name="entity_state" type="EntityState" />
            <attribute name="name" type="String" />
            <attribute name="job_type" type="JobType" />
            <attribute name="job_level" type="u8" />
            <attribute name="pk_state" type="PlayerKillState" />
            <attribute name="mounted" type="bool" /><!-- TODO if true, has u32 after in_combat -->
            <attribute name="in_combat" type="bool" />
            <attribute name="active_scroll" type="ActiveScroll" />
            <attribute name="unknown2" type="u8" value="0" />
        </variation>
        <variation name="Monster">
            <attribute name="unique_id" type="u32" />
            <attribute name="position" type="Position" />
            <attribute name="movement" type="EntityMovementState" />
            <attribute name="entity_state" type="EntityState" />
            <attribute name="interaction_options" type="InteractOptions" />
            <attribute name="rarity" type="EntityRarity" />
            <attribute name="unknown" type="u32" />
        </variation>
    </enum>

    <enum name="WeatherType" type="u8">
        <variation name="Clear" value="1" />
        <variation name="Rain" value="2" />
        <variation name="Snow" value="3" />
    </enum>

    <enum name="ConsignmentErrorCode" type="u16">
        <variation name="NotEnoughGold" value="0x700D" />
    </enum>

    <enum name="ConsignmentResult" type="u8">
        <variation name="Success" value="1">
            <attribute name="items" type="Vec" inner="ConsignmentItem" list-type="length" />
        </variation>
        <variation name="Error" value="2">
            <attribute name="code" type="ConsignmentErrorCode" />
        </variation>
    </enum>

    <enum name="GameNotificationContent" type="u8">
        <variation name="UniqueSpawned" value="0x05">
            <attribute name="unknown" type="u8" value="1" />
            <attribute name="ref_id" type="u16" />
        </variation>
        <variation name="UniqueKilled" value="0x06">
            <attribute name="ref_id" type="u16" />
        </variation>
    </enum>

    <enum name="MovementType" type="u8">
        <variation name="Running" value="0" />
        <variation name="Walking" value="1" />
    </enum>

    <enum name="ActionState" type="u8">
        <variation name="None" value="0" />
        <variation name="Walking" value="2" />
        <variation name="Running" value="3" />
        <variation name="Sitting" value="4" />
    </enum>

    <enum name="MovementTarget" type="u8">
        <variation name="TargetLocation" value="1">
            <attribute name="region" type="u16" />
            <attribute name="x" type="u16" />
            <attribute name="y" type="u16" />
            <attribute name="z" type="u16" />
        </variation>
        <variation name="Direction" value="0">
            <attribute name="unknown" type="u8" />
            <attribute name="angle" type="u16" />
        </variation>
    </enum>

    <enum name="EntityMovementState" type="u8">
        <variation name="Moving" value="1">
            <attribute name="movement_type" type="MovementType" />
            <attribute name="region" type="u16" />
            <attribute name="x" type="u16" />
            <attribute name="y" type="u16" />
            <attribute name="z" type="u16" />
        </variation>
        <variation name="Standing" value="0">
            <attribute name="movement_type" type="MovementType" />
            <attribute name="unknown" type="u8" />
            <attribute name="angle" type="u16" />
        </variation>
    </enum>

    <struct name="EntityState">
        <attribute name="alive" type="AliveState" />
        <attribute name="unknown1" type="u8" value="0" />
        <attribute name="action_state" type="ActionState" />
        <attribute name="body_state" type="BodyState" />
        <attribute name="unknown2" type="u8" value="0" />
        <attribute name="walk_speed" type="f32" />
        <attribute name="run_speed" type="f32" />
        <attribute name="berserk_speed" type="f32" />
        <attribute name="active_buffs" type="Vec" inner="ActiveBuffData" list-type="length" />
    </struct>

    <struct name="InventoryItemMagicData">

    </struct>

    <struct name="InventoryItemBindingData">
        <attribute name="kind" type="u8" />
        <attribute name="value" type="u8" />
    </struct>

    <struct name="MasteryData">
        <attribute name="id" type="u32" />
        <attribute name="level" type="u8" />
    </struct>

    <struct name="ActiveQuestData">
        <attribute name="id" type="u32" />
        <attribute name="repeat_count" type="u8" />
        <attribute name="unknown_1" type="u8" value="1" />
        <attribute name="unknown_2" type="u16" value="0" />
        <attribute name="kind" type="u8" /> <!-- 8, 24 or 88 -->
        <attribute name="status" type="u8" /> <!-- 1 = untouched, 7 = started, 8 = completed -->
        <attribute name="objectives" type="Vec" inner="ActiveQuestObjectData" list-type="length" />
    </struct>

    <struct name="ActiveQuestObjectData">
        <attribute name="index" type="u8" />
        <attribute name="incomplete" type="bool" />
        <attribute name="name" type="String" />
        <attribute name="tasks" type="Vec" inner="u32" list-type="length" />
        <attribute name="task_ids" type="Vec" inner="u32" list-type="length" />
    </struct>

    <struct name="InventoryItemData">
        <attribute name="slot" type="u8" />
        <attribute name="rent_data" type="u32" />
        <attribute name="item_id" type="u32" />
        <attribute name="content_data" type="InventoryItemContentData" />
    </struct>

    <struct name="InventoryAvatarItemData">

    </struct>

    <struct name="ActiveBuffData">
        <attribute name="id" type="u32" />
        <attribute name="token" type="u32" />
        <!-- <attribute name="is_creator" type="bool"> <- only when buff is of certain type -->
    </struct>

    <struct name="HotkeyData">
        <attribute name="slot" type="u8" />
        <attribute name="kind" type="u8" />
        <attribute name="data" type="u32" />
    </struct>

    <struct name="FriendListGroup">
        <attribute name="id" type="u16" />
        <attribute name="name" type="String" />
    </struct>

    <struct name="FriendListEntry">
        <attribute name="char_id" type="u32" />
        <attribute name="name" type="String" />
        <attribute name="char_model" type="u32" />
        <attribute name="group_id" type="u16" />
        <attribute name="offline" type="bool" />
    </struct>

    <struct name="ConsignmentItem">
        <attribute name="personal_id" type="u32" />
        <attribute name="status" type="u8" />
        <attribute name="ref_item_id" type="u32" />
        <attribute name="sell_count" type="u32" />
        <attribute name="price" type="u64" />
        <attribute name="deposit" type="u64" />
        <attribute name="fee" type="u64" />
        <attribute name="end_date" type="u32" />
    </struct>

    <enum name="MovementDestination" type="u8">
        <variation name="Direction" value="0">
            <attribute name="moving" type="bool" />
            <attribute name="heading" type="u16" />
        </variation>
        <variation name="Location" value="1">
            <attribute name="region" type="u16" />
            <attribute name="x" type="u16" />
            <attribute name="y" type="u16" />
            <attribute name="z" type="u16" />
        </variation>
    </enum>

    <struct name="MovementSource">
        <attribute name="region" type="u16" />
        <attribute name="x" type="u16" />
        <attribute name="y" type="f32" />
        <attribute name="z" type="u16" />
    </struct>

    <packet name="CelestialUpdate" source="server" opcode="0x3020">
        <attribute name="unique_id" type="u32" />
        <attribute name="moon_position" type="u16" />
        <attribute name="hour" type="u8" />
        <attribute name="minute" type="u8" />
    </packet>

    <packet name="LunarEventInfo" source="server" opcode="0x34f2">
        <attribute name="unknown_1" type="u8" value="2" />
        <attribute name="unknown_2" type="u8" value="3" />
        <attribute name="unknown_3" type="u32" value="1" />
        <attribute name="unknown_4" type="u32" value="0x7535" />
        <attribute name="current_achieved" type="u32" />
        <attribute name="total" type="u32" />
    </packet>

    <packet name="CharacterSpawnStart" source="server" opcode="0x34A5" />
    <packet name="CharacterSpawn" source="server" opcode="0x3013">
        <attribute name="time" type="u32" />
        <attribute name="ref_id" type="u32" />
        <attribute name="scale" type="u8" />
        <attribute name="level" type="u8" />
        <attribute name="max_level" type="u8" />
        <attribute name="exp" type="u64" />
        <attribute name="sp_exp" type="u32" />
        <attribute name="gold" type="u64" />
        <attribute name="sp" type="u32" />
        <attribute name="stat_points" type="u16" />
        <attribute name="berserk_points" type="u8" />
        <attribute name="unknown_1" type="u32" value="0" />
        <attribute name="hp" type="u32" />
        <attribute name="mp" type="u32" />
        <attribute name="beginner" type="bool" />
        <attribute name="player_kills_today" type="u8" />
        <attribute name="player_kills_total" type="u16" />
        <attribute name="player_kills_penalty" type="u32" />
        <attribute name="berserk_level" type="u8" /> <!-- maybe "title" better word? -->
        <attribute name="free_pvp" type="u8" />
        <attribute name="fortress_war_mark" type="u8" />
        <attribute name="service_end" type="DateTime" />
        <attribute name="user_type" type="u8" />
        <attribute name="server_max_level" type="u8" />
        <attribute name="unknown_2" type="u16" value="0x0107" />
        <attribute name="inventory_size" type="u8" />
        <attribute name="inventory_items" type="Vec" inner="InventoryItemData" list-type="length" />
        <attribute name="avatar_item_size" type="u8" />
        <attribute name="avatar_items" type="Vec" inner="InventoryAvatarItemData" list-type="length" />
        <attribute name="unknown_3" type="u8" value="0" /> <!-- it's 8 now?! -->
        <attribute name="unknown_4" type="u8" value="0xb" /> <!-- maybe job mastery? -->
        <attribute name="unknown_5" type="u16" value="0" />
        <attribute name="masteries" type="Vec" inner="MasteryData" list-type="break" />
        <attribute name="unknown_6" type="u8" value="0" />
        <attribute name="unknown_7" type="u8" value="2" /> <!-- it's 1 now ?? -->
        <attribute name="completed_quests" type="Vec" inner="u32" list-type="length" size="2" />
        <attribute name="active_quests" type="Vec" inner="ActiveQuestData" list-type="length" />
        <attribute name="unknown_8" type="u8" value="0" />
        <attribute name="unknown_9" type="u32" value="0" /> <!-- talismans? -->
        <attribute name="unique_id" type="u32" />
        <attribute name="position" type="Position" />
        <attribute name="destination_flag" type="u8" />
        <attribute name="unknown_10" type="u8" value="1" />
        <attribute name="unknown_11" type="u8" value="0" />
        <attribute name="angle" type="u16" />
        <attribute name="entity_state" type="EntityState" />
        <attribute name="character_name" type="String" />
        <attribute name="unknown_14" type="u16" value="0" />
        <attribute name="job_name" type="String" />
        <attribute name="job_type" type="JobType" />
        <attribute name="job_level" type="u8" />
        <attribute name="job_exp" type="u32" />
        <attribute name="job_contribution" type="u32" />
        <attribute name="job_reward" type="u32" />
        <attribute name="pvp_state" type="u8" /> <!-- should be 0x22 or 0xFF -->
        <attribute name="transport_flag" type="bool" />
        <attribute name="in_combat" type="u8" />
        <attribute name="unknown_15" type="u8" value="0" />
        <attribute name="unknown_16" type="u8" value="0" />
        <attribute name="pvp_flag" type="u8" />
        <attribute name="unknown_17" type="u8" value="0xFF" />
        <attribute name="unknown_18" type="u64" value="0x8000d7" /> <!-- guide data?, 0xc002d7 now -->
        <attribute name="jid" type="u32" />
        <attribute name="gm" type="bool" />
        <attribute name="unknown_19" type="u32" value="0x19" />
        <attribute name="hotkeys" type="Vec" inner="HotkeyData" list-type="length" />
        <attribute name="unknown_20" type="u8" value="0" />
        <attribute name="auto_hp" type="u16" />
        <attribute name="auto_mp" type="u16" />
        <attribute name="auto_pill" type="u16" />
        <attribute name="potion_delay" type="u8" />
        <attribute name="blocked_players" type="Vec" inner="String" list-type="length" />
        <attribute name="unknown_21" type="u32" value="0x9f000000" /> <!-- guide data? 0x7d now -->
    </packet>
    <packet name="CharacterSpawnEnd" source="server" opcode="0x34A6" />

    <packet name="CharacterFinished" source="server" opcode="0x3077">
        <attribute name="unknown" type="u16" value="0" />
    </packet>

    <packet name="EntityDespawn" source="server" opcode="0x3016">
        <attribute name="entity_id" type="u32" />
    </packet>

    <packet name="EntitySpawn" source="server" opcode="0x3015">
        <attribute name="spawn_data" type="EntityTypeSpawnData" />
        <attribute name="unknown_3" type="u8" value="5" />
        <attribute name="unknown_4" type="u32" value="0" />
        <attribute name="unknown_5" type="u8" value="4" />
    </packet>

    <packet name="GroupEntitySpawnStart" source="server" opcode="0x3017">
        <attribute name="kind" type="GroupSpawnType" />
        <attribute name="amount" type="u16" />
        <attribute name="unknown_1" type="u32" value="0" />
        <attribute name="unknown_2" type="u16" value="0" />
    </packet>

    <packet name="GroupEntitySpawnData" source="server" opcode="0x3019">
        <attribute name="content" type="Vec" inner="GroupSpawnDataContent" list-type="none" />
    </packet>

    <packet name="GroupEntitySpawnEnd" source="server" opcode="0x3018" />

    <packet name="ConsignmentList" source="client" opcode="0x750E" />

    <packet name="ConsignmentResponse" source="server" opcode="0xB50E">
        <attribute name="result" type="ConsignmentResult" />
    </packet>

    <packet name="WeatherUpdate" source="server" opcode="0x3809">
        <attribute name="kind" type="WeatherType" />
        <attribute name="speed" type="u8" />
    </packet>

    <packet name="FriendListInfo" source="server" opcode="0x3305">
        <attribute name="groups" type="Vec" inner="FriendListGroup" list-type="length" />
        <attribute name="friends" type="Vec" inner="FriendListEntry" list-type="length" />
    </packet>

    <packet name="GameNotification" source="server" opcode="0x300C">
        <attribute name="result" type="GameNotificationContent" />
    </packet>

    <packet name="PlayerMovementRequest" source="client" opcode="0x7021">
        <attribute name="kind" type="MovementTarget" />
    </packet>

    <packet name="PlayerMovementResponse" source="server" opcode="0xB021">
        <attribute name="player_id" type="u32" />
        <attribute name="destination" type="MovementDestination" />
        <attribute name="source_position" type="Option" inner="MovementSource" />
    </packet>

    <packet name="AddFriend" source="client" opcode="0x7302">
        <attribute name="name" type="String" />
    </packet>

    <packet name="CreateFriendGroup" source="client" opcode="0x7310">
        <attribute name="name" type="String" />
    </packet>

    <packet name="DeleteFriend" source="client" opcode="0x7304">
        <attribute name="friend_character_id" type="u32" />
    </packet>

    <packet name="Rotation" source="client" opcode="0x7024">
        <attribute name="heading" type="u16" />
    </packet>

    <packet name="EntityUpdateState" source="server" opcode="0x30BF">
        <attribute name="unique_id" type="u32" />
        <attribute name="kind" type="u8" /><!-- TODO make to proper enum -->
        <attribute name="value" type="u8" />
    </packet>

    <enum name="TargetEntityResult" type="u8">
        <variation name="Failure" value="0">
            <attribute name="error" type="u16" />
        </variation>
        <variation name="Success" value="1">
            <attribute name="unique_id" type="u32" />
            <attribute name="unknown1" type="u8" value="1" />
            <attribute name="unknown2" type="u8" value="5" />
            <attribute name="unknown3" type="u8" value="4" />
        </variation>
    </enum>

    <packet name="TargetEntity" source="client" opcode="0x7045">
        <attribute name="unique_id" type="u32" />
    </packet>

    <packet name="TargetEntityResponse" source="server" opcode="0xB045">
        <attribute name="result" type="TargetEntityResult" />
    </packet>

    <packet name="UnTargetEntity" source="client" opcode="0x704B">
        <attribute name="unique_id" type="u32" />
    </packet>

    <packet name="UnTargetEntityResponse" source="server" opcode="0xB04B">
        <attribute name="success" type="bool" />
    </packet>
</packets>